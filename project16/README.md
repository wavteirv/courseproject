1. 导入所需的库，包括 hashlib 用于哈希函数、random 用于生成随机数、socket 用于网络通信等。

2. 定义了椭圆曲线的参数和曲线对象 E，以及生成元 G。

3. 创建了一个客户端的 socket，并连接到服务器。

4. 定义了一些辅助函数：int2str 用于将整数转换成指定长度的十六进制字符串，Hash 用于计算哈希值，KDF 用于生成密钥派生函数，xor 用于进行异或运算。

5. 协商共享的公钥以及各自私钥：
   
  （1）生成随机数 d_1 和对应的公钥 P_1。
  
  （2）将 P_1 的坐标发送给服务器。
  
  （3）从服务器接收对方的公钥 P。

7. 加密过程：

  （1）生成随机数 k。
  
  （2）计算 C_1 = k * G 和 kP = k * P。
  
  （3）通过 KDF 生成密钥 t。
  
  （4）计算 C_2 = M 异或 t，其中 M 为待加密的消息。
  
  （5）计算 C_3 = Hash(int2str(kP.x) + M + int2str(kP.y))。
  
  （6）最终密文 C 为 (C_1, C_2, C_3)。

9. 解密过程：
 
  （1）将解密请求发送给服务器。
  
  （2） 生成随机数 T_1 和对应的公钥 T_2。
  
  （3）将 T_2 的坐标发送给服务器。
  
  （4）从服务器接收对方的公钥 nC_1。
  
  （5）计算 kP = T_2 + nC_1。
  
  （6）通过 KDF 生成密钥 t。

  （7）计算原始消息 M = C_2 异或 t，并删除填充的零字节。

10. 输出解密后的原始消息 M。
