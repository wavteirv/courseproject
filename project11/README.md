# impl sm2 with RFC6979
### SM2数字签名算法基于椭圆曲线密码体制，涉及椭圆曲线的点加法、点倍乘等运算。RFC 6979规定了一种确定性的随机数生成算法，解决了传统ECDSA中随机数的问题。本实验将结合SM2和RFC 6979的算法原理，实现基于RFC 6979的SM2数字签名算法。

当实现基于RFC 6979的SM2算法时，我们需要理解SM2算法和RFC 6979的原理。下面将对这两个部分进行详细展开：

#### 1. SM2算法原理

SM2是一种椭圆曲线密码算法，广泛应用于数字签名和密钥交换。它使用椭圆曲线上的点进行加密和签名，并且具有高度的安全性和性能。

1.1 椭圆曲线密码学基础

SM2的基础是椭圆曲线密码学，它使用椭圆曲线上的点和运算来实现加密和签名。椭圆曲线可以表示为一个方程：y^2 = x^3 + ax + b，其中a和b是曲线的参数。曲线上的点满足这个方程，并且构成一个群。

1.2 SM2密钥生成

SM2的密钥生成过程涉及以下步骤：
- 选择一个椭圆曲线，包括曲线方程、基点G和阶数n。
- 随机选择一个私钥d，d应该是一个在[1, n-2]范围内的随机整数。
- 计算公钥P = d * G，即将基点G乘以私钥d得到公钥。

1.3 SM2数字签名

SM2的数字签名过程涉及以下步骤：
- 选择一个随机数k，k应该是一个在[1, n-1]范围内的随机整数。
- 计算点R = k * G，即将基点G乘以随机数k得到临时公钥。
- 计算消息的哈希值H。
- 计算签名参数r = (H + x(R)) % n，其中x(R)是临时公钥R的x坐标。
- 计算签名参数s = ((1 + d)^-1 * (k - d * r)) % n，其中d是私钥。

1.4 SM2签名验证

SM2的签名验证过程涉及以下步骤：
- 接收方计算消息的哈希值H。
- 解析收到的签名(R, s)。
- 计算签名参数s' = (r' + H) % n，其中r'是解析得到的签名R的x坐标。
- 计算验证参数t = (r' + s') % n。
- 如果t与r'相等，则签名有效。

#### 2. RFC 6979原理

RFC 6979定义了一种确定性签名算法，用于替代传统的基于随机数的签名算法。RFC 6979的目的是消除基于真随机数的签名算法中的安全隐患，特别是在敌对环境中，防止随机数被攻击者预测或猜测。

2.1 随机数生成

在传统的签名算法中，签名需要使用一个随机数k，这个随机数必须是每次都不同的，否则会导致签名的不安全性。RFC 6979通过使用私钥和消息的哈希值来生成签名所需的随机数k。具体而言，RFC 6979使用HMAC-SHA256函数来计算伪随机数k，其中HMAC的密钥是私钥，消息是消息的哈希值。

2.2 RFC 6979的优点

使用RFC 6979确定性签名算法的优点包括：
- 不需要真随机数生成器，避免了真随机数生成器可能带来的安全问题。
- 保持了签名的随机性，避免了相同的随机数被重复使用，从而防止了攻击者预测随机数并导致签名被破解。

### 3. 实验步骤

代码中需要提前下载ecpy库

（1）选择合适的椭圆曲线参数：在实现SM2算法前，首先选择合适的椭圆曲线参数，包括曲线方程、基点坐标、有限域等。

（2）密钥生成：根据椭圆曲线参数，生成SM2的公钥和私钥。

（3）消息哈希：对待签名的消息进行哈希计算，得到消息摘要。

（4）随机数生成：利用RFC 6979规定的算法，基于私钥和消息摘要生成确定性随机数。

（5）签名计算：根据RFC 6979生成的随机数和消息摘要，结合私钥，计算SM2的数字签名。

（6）签名验证：利用公钥、消息摘要和签名，进行SM2签名验证


### 4. 运行结果

<img width="468" alt="1" src="https://github.com/wavteirv/sdu-project-group78/assets/102475494/f5829acd-04cc-4d56-9afb-64d53ed2f550">
